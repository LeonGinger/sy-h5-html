(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-modify"],{1303:function(e,n,t){var o=t("4b09");"string"===typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);var i=t("4f06").default;i("80c8a592",o,!0,{sourceMap:!1,shadowMode:!1})},2375:function(e,n,t){"use strict";var o=t("1303"),i=t.n(o);i.a},"4b09":function(e,n,t){var o=t("24fb");n=o(!1),n.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.imgbox[data-v-4514aa93]{box-shadow:0 0 %?15?% #c0c4cc;border-radius:50%;width:%?120?%;height:%?120?%}.imgbox uni-image[data-v-4514aa93]{border-radius:50%}uni-page-body[data-v-4514aa93]{background-color:initial}.modify .bg[data-v-4514aa93]{width:100%;height:100%;z-index:-1;position:fixed;top:0;left:0}.modify .information[data-v-4514aa93]{width:90%;background-color:#fff;border-radius:%?30?%;margin:%?50?% auto;box-shadow:0 0 %?15?% #d0d5dd}.modify .information .text[data-v-4514aa93]{padding-top:%?20?%;text-align:center;font-size:%?38?%}.modify .information .content[data-v-4514aa93]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-wrap:wrap;flex-wrap:wrap;font-size:%?30?%}.modify .information .content .img[data-v-4514aa93]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?20?% %?30?%;padding-bottom:%?20?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;border-bottom:%?1?% solid #f1f1f1}.modify .information .content .img .information_img[data-v-4514aa93]{border-radius:50%}.modify .information .content .name[data-v-4514aa93]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?30?%;padding-bottom:%?30?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;border-bottom:%?1?% solid #f1f1f1}.modify .information .content .name .information_name[data-v-4514aa93]{text-align:right}.modify .information .content .namec[data-v-4514aa93]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?30?%;padding-bottom:%?30?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;border-bottom:%?3?% solid red}.modify .information .content .namec .information_name[data-v-4514aa93]{text-align:right}.modify .information .content .phone[data-v-4514aa93]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?30?%;padding-bottom:%?30?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.modify .information .content .phone .information_phone[data-v-4514aa93]{text-align:right;font-weight:700}.modify .information .content .phonec[data-v-4514aa93]{width:100%;border-bottom:%?3?% solid red;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?30?%;padding-bottom:%?30?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.modify .information .content .phonec .information_phone[data-v-4514aa93]{text-align:right;font-weight:700}.modify .information .content .code[data-v-4514aa93]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:%?30?%;padding-bottom:%?30?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.modify .information .content .code .code_text[data-v-4514aa93]{white-space:nowrap!important}.modify .information .content .code .information_code[data-v-4514aa93]{text-align:right;font-weight:700}.modify .information .content .code .send_code[data-v-4514aa93]{background-color:#0abb9a;white-space:nowrap;margin-left:%?10?%;padding:%?20?%;font-size:%?24?%;color:#fff;border-radius:%?15?%}.modify .btn[data-v-4514aa93]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-justify-content:space-around;justify-content:space-around;font-size:%?32?%;margin:0 %?60?%}.modify .btn .back[data-v-4514aa93]{border-radius:%?20?%;padding:%?10?% %?55?%;color:#0abb9a;background-color:#fff;border:%?2?% solid #0abb9a}.modify .btn .jump[data-v-4514aa93]{border-radius:%?20?%;padding:%?10?% %?55?%;background-color:#0abb9a;color:#fff}.modify .caption[data-v-4514aa93]{position:fixed;line-height:%?40?%;bottom:%?80?%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);text-align:center;color:#c0c4cc;font-size:%?22?%;z-index:-1}body.?%PAGE?%[data-v-4514aa93]{background-color:initial}',""]),e.exports=n},"73d9":function(e,n,t){e.exports=t.p+"static/img/my-bg.de4e4deb.jpg"},8707:function(e,n,t){"use strict";var o=t("4ea4");t("d3b7"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,t("96cf");var i=o(t("1da1")),a=o(t("05bb")),r={data:function(){return{verify_if:"",yzm:!1,fu:!0,lxfsTop:"",bottomBarTop:"",model:"",company:"",TIME_COUNT:60,count:"",show:!0,token:"",userinfo:[],grant_code:"",source_code:"",business_name:"",information:{username:"",phone:"",user_image:"",phonecode:""}}},onLoad:function(e){var n=this,t=e.grant_code;n.grant_code=e.grant_code,console.log("grant_code",n.grant_code);var o=e.source_code;n.source_code=e.source_code,console.log("_this.source_code",n.source_code),this.$api.userinfo().then((function(e){console.log("用户信息",e),n.userinfo=e.data,e.data.business&&(n.business_name=e.data.business.business_name,n.verify_if=e.data.business.verify_if),n.information.phone=n.userinfo.phone,n.information.user_image=n.userinfo.user_image,n.information.username=t||o?"":n.userinfo.username})),void 0==e.company||(n.company=e.company,uni.setNavigationBarTitle({title:"完善个人资料"}))},methods:{back:function(){uni.navigateBack({})},jump:function(){var e=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=e,uni.showLoading({title:"加载中...",mask:!0}),e.information.username){n.next=7;break}uni.hideLoading(),uni.showModal({title:"提示",content:"您的昵称尚未填写",showCancel:!1,confirmColor:"#0ABB9A"}),n.next=32;break;case 7:if(e.information.phone){n.next=12;break}uni.hideLoading(),uni.showModal({title:"提示",content:"您的手机号码未填写",showCancel:!1,confirmColor:"#0ABB9A"}),n.next=32;break;case 12:if(11==e.information.phone.length){n.next=17;break}uni.hideLoading(),uni.showModal({title:"提示",content:"您输入的手机号码有误",showCancel:!1,confirmColor:"#0ABB9A"}),n.next=32;break;case 17:if(e.userinfo.phone==e.information.phone||e.information.phonecode){n.next=22;break}uni.hideLoading(),uni.showModal({title:"提示",content:"请输入验证码",showCancel:!1,confirmColor:"#0ABB9A"}),n.next=32;break;case 22:if(!(e.information.username||e.information.phone||e.information.phonecode)){n.next=32;break}if(t.userinfo.user_image!==t.information.user_image){n.next=26;break}n.next=31;break;case 26:if("http"==t.information.user_image.substring(0,4)){n.next=31;break}return n.next=29,t.$api.upFile(t.information.user_image).then((function(e){console.log("res",e);var n=JSON.parse(e[1].data);t.information.user_image=n.data.link}));case 29:n.next=31;break;case 31:e.$api.usersave(t.information).then((function(e){console.log("ressss",e),e?(uni.hideLoading(),uni.showModal({title:"提示",content:"修改成功",showCancel:!1,confirmColor:"#0ABB9A",success:function(e){t.grant_code||t.source_code?t.grant_code&&!t.source_code?uni.navigateTo({url:"../scan/staffscan?grant_code="+t.grant_code}):t.source_code&&!t.grant_code&&uni.navigateTo({url:"../traceability/traceability?source_code="+t.source_code}):wx.reLaunch({url:"./my"})}})):uni.hideLoading()})).catch((function(e){console.log("err",e),uni.hideLoading(),"验证码错误"==e.data.message&&uni.showModal({title:"提示",content:"验证码错误",showCancel:!1,confirmColor:"#0ABB9A"})}));case 32:case"end":return n.stop()}}),n)})))()},handleChooseImg:function(){var e=this;uni.chooseImage({count:1,sizeType:["original","compressed"],success:function(n){var t=n.tempFilePaths;e.detail(t[0])}})},onName:function(e){console.log(" this.information.user_image",this.information.user_image),this.fu=!1,this.yzm=!1},onInput:function(e){console.log(e),this.yzm=!0,this.fu=!1},onHeight:function(e){this.fu=!1},noInput:function(e){this.fu=!0,this.information.phone!=this.userinfo.phone&&""!=this.information.phone||(this.yzm=!1)},send_Code:function(){var e=this,n=this;this.information.phone.length<11||this.information.phone==this.userinfo.phone?uni.showToast({icon:"none",title:"手机号输入有误"}):this.timer||(this.count=this.TIME_COUNT,this.show=!1,n.$api.iphone_code({mobile:this.information.phone}).then((function(e){console.log("res",e),uni.showModal({title:"提示",content:"手机二维码已发送\n请你打开短信查看\n",showCancel:!1,confirmColor:"#0ABB9A"})})).catch((function(e){console.log("err",e.data.message),uni.showModal({title:"提示",content:e.data.message,confirmColor:"#0ABB9A",showCancel:!1,success:function(e){n.information.phone,n.userinfo.phone}})})),this.timer=setInterval((function(){e.count>0&&e.count<=e.TIME_COUNT?e.count--:(e.show=!0,clearInterval(e.timer),e.timer=null)}),1e3))},onResize:function(e){alert(e)},detail:function(e){var n=this;return(0,i.default)(regeneratorRuntime.mark((function t(){var o,i,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("url",e),o=500,i=1,t.next=5,n.getImageTag(e,"Orientation",(function(e){void 0!=e&&(i=e)}));case 5:return a=null,r=null,t.next=9,n.comprossImage(e,o,(function(e){a=e.img,r=e.canvas}));case 9:"",t.t0=i,t.next=6===t.t0?13:8===t.t0?15:3===t.t0?17:19;break;case 13:return n.rotateImg(a,"right",r),t.abrupt("break",21);case 15:return n.rotateImg(a,"left",r),t.abrupt("break",21);case 17:return n.rotateImg(a,"right",r,2),t.abrupt("break",21);case 19:return n.rotateImg(a,"",r),t.abrupt("break",21);case 21:case"end":return t.stop()}}),t)})))()},comprossImage:function(e,n,t){return(0,i.default)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",0);case 2:return n.abrupt("return",new Promise((function(n,o){uni.getImageInfo({src:e,success:function(e){var o=new Image;o.src=e.path;var i=document.createElement("canvas"),a=new Object;a.img=o,a.canvas=i,n(t(a))}})})));case 3:case"end":return n.stop()}}),n)})))()},getImageTag:function(e,n,t){return e?new Promise((function(n,o){var i=new Image;i.src=e,console.log("imgObj",i),uni.getImageInfo({src:e,success:function(e){a.default.getData(i,(function(){a.default.getAllTags(this);var e=a.default.getTag(this,"Orientation");n(t(e))}))}})})):0},rotateImg:function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=this;console.log("开始旋转");var a=0,r=3;if(null!=e){var s=e.height,c=e.width,u=400,d=c,f=s,l=d/f;console.log(u),d>u&&(d=u,f=Math.floor(d/l)),c=d,s=f;var m=0;null==m&&(m=a),"right"==n?(m+=o,m>r&&(m=a)):"left"==n?(m-=o,m<a&&(m=r)):m=0;var p=90*m*Math.PI/180,g=t.getContext("2d");switch(console.log("degree",p),console.log("step",m),m){case 1:console.log("右旋转 90度"),t.width=s,t.height=c,g.rotate(p),g.drawImage(e,0,-s,c,s);break;case 2:t.width=c,t.height=s,g.rotate(p),g.drawImage(e,-c,-s,c,s);break;case 3:console.log("左旋转 90度"),t.width=s,t.height=c,g.rotate(p),g.drawImage(e,-c,0,c,s);break;default:t.width=c,t.height=s,g.drawImage(e,0,0,c,s);break}var b=t.toDataURL("image/jpeg",1);i.information.user_image=b}}},onReady:function(){var e=this;uni.getSystemInfo({success:function(n){console.log(n),e.lxfsTop=n.windowHeight-88+"px",e.bottomBarTop=n.windowHeight-56+"px",e.model=n.model}})}};n.default=r},ba10:function(e,n,t){"use strict";var o;t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var i=function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("v-uni-view",{staticClass:"modify"},[o("v-uni-image",{staticClass:"bg",attrs:{src:t("73d9")}}),o("v-uni-view",{staticClass:"information"},[o("v-uni-view",{staticClass:"text"},[e._v(e._s(0==e.company?"个人信息编辑":"请完善个人资料"))]),o("v-uni-view",{staticClass:"content"},[o("v-uni-view",{staticClass:"img"},[o("v-uni-view",{staticClass:"information_text"},[e._v("我的头像")]),o("v-uni-view",{staticClass:"imgbox"},[o("v-uni-image",{staticStyle:{width:"130upx",height:"130upx","background-color":"white"},attrs:{src:e.information.user_image},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.handleChooseImg.apply(void 0,arguments)}}})],1)],1),e.business_name&&2!=e.verify_if?o("v-uni-view",{staticClass:"name"},[o("v-uni-view",{staticClass:"information_text"},[e._v(e._s(3!=e.verify_if?"商家名称":"商家状态"))]),3!=e.verify_if?o("v-uni-text",{staticClass:"information_name"},[e._v(e._s(e.business_name))]):e._e(),3==e.verify_if?o("v-uni-text",{staticClass:"information_name"},[e._v("商家信息审核中...")]):e._e()],1):e._e(),o("v-uni-view",{class:e.grant_code||e.source_code?"namec":"name"},[e.grant_code||e.source_code?e._e():o("v-uni-view",{staticClass:"information_text"},[e._v("我的昵称")]),e.grant_code||e.source_code?o("v-uni-view",{staticClass:"information_text"},[e._v("真实姓名")]):e._e(),e.grant_code||e.source_code?o("v-uni-input",{staticClass:"information_name",attrs:{placeholder:"请输入您的真实姓名",maxlength:"4"},on:{focus:function(n){arguments[0]=n=e.$handleEvent(n),e.onName.apply(void 0,arguments)},blur:function(n){arguments[0]=n=e.$handleEvent(n),e.noInput.apply(void 0,arguments)}},model:{value:e.information.username,callback:function(n){e.$set(e.information,"username",n)},expression:"information.username"}}):e._e(),e.grant_code||e.source_code?e._e():o("v-uni-input",{staticClass:"information_name",attrs:{placeholder:"请输入您的昵称",maxlength:"8"},on:{focus:function(n){arguments[0]=n=e.$handleEvent(n),e.onName.apply(void 0,arguments)},blur:function(n){arguments[0]=n=e.$handleEvent(n),e.noInput.apply(void 0,arguments)}},model:{value:e.information.username,callback:function(n){e.$set(e.information,"username",n)},expression:"information.username"}})],1),o("v-uni-view",{class:e.grant_code||e.source_code?"phonec":"phone",style:1==e.yzm?"border-bottom: 1rpx solid #f1f1f1;margin-bottom: 0;":""},[o("v-uni-view",{staticClass:"information_text"},[e._v("手机号")]),o("v-uni-input",{staticClass:"information_phone",attrs:{type:"number",placeholder:"请输入您的手机号",maxlength:"11"},on:{focus:function(n){arguments[0]=n=e.$handleEvent(n),e.onInput.apply(void 0,arguments)},blur:function(n){arguments[0]=n=e.$handleEvent(n),e.noInput.apply(void 0,arguments)}},model:{value:e.information.phone,callback:function(n){e.$set(e.information,"phone",n)},expression:"information.phone"}})],1),1==e.yzm?o("v-uni-view",{staticClass:"code"},[o("v-uni-view",{staticClass:"code_text"},[e._v("验证码")]),o("v-uni-input",{staticClass:"information_code",attrs:{placeholder:"请输入验证码",maxlength:"6"},on:{focus:function(n){arguments[0]=n=e.$handleEvent(n),e.onHeight.apply(void 0,arguments)},blur:function(n){arguments[0]=n=e.$handleEvent(n),e.noInput.apply(void 0,arguments)}},model:{value:e.information.phonecode,callback:function(n){e.$set(e.information,"phonecode",n)},expression:"information.phonecode"}}),o("v-uni-view",{staticClass:"send_code",style:e.timer?"background:#cccccc":"",attrs:{type:"“default”",disabled:!e.show},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.send_Code.apply(void 0,arguments)}}},[e._v(e._s(e.timer?e.count+"s":"发送验证码"))])],1):e._e()],1)],1),o("v-uni-view",{staticClass:"btn"},[o("v-uni-view",{staticClass:"back",on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.back.apply(void 0,arguments)}}},[e._v("返回")]),o("v-uni-view",{staticClass:"jump",on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.jump.apply(void 0,arguments)}}},[e._v(e._s(0==e.company?"提交":"确定"))])],1),o("bottomBar",{style:1==e.fu?"":{top:e.bottomBarTop}})],1)},a=[]},c8c1:function(e,n,t){"use strict";t.r(n);var o=t("ba10"),i=t("f600");for(var a in i)"default"!==a&&function(e){t.d(n,e,(function(){return i[e]}))}(a);t("2375");var r,s=t("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"4514aa93",null,!1,o["a"],r);n["default"]=c.exports},f600:function(e,n,t){"use strict";t.r(n);var o=t("8707"),i=t.n(o);for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=i.a}}]);